###### 前言

阅读《Concurrency in Go》做的笔记，整理书中提到的关键内容。如有理解错误的地方，不代表原作者的观点。

###### 死锁

###### 活锁

线程在空转，但是始终要不到资源。

###### 饿死

饿死是说线程无法获取到任务所需的全部资源。

###### 并发模式

Hoare在他的论文Communicating Sequential Processes中介绍了这种进程间通信技术，不过是以CSP编程语言的方式。CSP中引入了输入命令!，输出命令?，。同时，guarded命令的语义：左手侧的代码是条件，或者叫做guard，如果左手侧的代码执行出错或者退出，右手侧的代码并不会被执行。channel的基础CSP。

CSP的message-passing风格，另外一种是共享内存风格，这种风格其实就是各种同步技术，包括锁技术、条件变量。在分布式系统中只有message-passing风格实用。

~~goroutine和channel，channel是可组合的，。select语句是channel的补充，允许你高效地等待事件，从channel中随机地选取一个消息，，~~

~~sync关键字的结构体和方法，允许你执行锁、创建资源池、抢占goroutine。~~

如何在message-passing风格和共享内存风格之间选择：

1.是否需要转移数据的所有权吗？

将一段代码的执行结果共享给另一段代码，你要做的是转移它的所有权。并发程序保证内存所有权的安全性是同一时刻只有一个并发上下文持有数据的所有权。

Channel可以表达内存所有权的转移，这样做的好处是可以创建缓冲channel实现in-memory队列，从而解耦生产者和消费者。另一个好处是，使用channel，你可以组合并发代码。

2.需要保护结构体的内部状态吗？

这是访存同步原语的一个候选例子，不应该使用channel。

~~同步原语可以隐藏隐藏~~

~~如果您还记得原子性的概念，我们可以说，我们在这里所做的是为Counter类型定义原子性的范围。~~

3.需要协调代码逻辑吗？

如果使用同步原语变得难以理解并发代码的执行逻辑，难以排查为什么死锁或出现竟态条件，尝试切换到channel，channel比同步原语更易组合。

4.是否存在性能瓶颈？

程序的某个部分遇到了性能瓶颈，尝试同步原语。channel底层使用了同步原语，只会比直接使用同步原语更慢。在考虑这一点之前，先想想能不能重构程序。

##### 并发模式

共享内存的同步原语、channel、不可变数据、
